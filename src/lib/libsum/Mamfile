note *
note * This build file is in the Make Abstract Machine (MAM) language. It was
note * first generated by nmake, but in the ksh 93u+m distribution we maintain
note * it manually because nmake had too many problems to keep using. The
note * Mamfiles are processed by mamake (src/cmd/INIT/mamake.c); we added
note * indentation to improve readability. The language is documented in
note * src/cmd/INIT/README-mamake.md.
note *
setv MAMAKE_STRICT
setv INSTALLROOT ../../..
setv PACKAGE_ast_INCLUDE ${INSTALLROOT}/include/ast
setv PACKAGEROOT ../../../../..
setv AR ${mam_cc_AR} ${mam_cc_AR_ARFLAGS}
setv CC cc
setv mam_cc_FLAGS ${mam_cc_PIC}
setv CCFLAGS ${-debug-symbols?1?${mam_cc_DEBUG} -D_BLD_DEBUG?${mam_cc_OPTIMIZE}?}
setv COTEMP $$
setv IFFEFLAGS
setv LDFLAGS
make install
	make sum
		make sum.req
			prev ${INSTALLROOT}/bin/mkreq
			exec - mkreq ${CC} ${mam_cc_FLAGS} ${CCFLAGS} : ${LDFLAGS} : sum md ast
		done sum.req generated
		make libsum.a archive
			prev sum.req
			make sumlib.o
				make sumlib.c
					make sum-sha2.c implicit
						make ${PACKAGE_ast_INCLUDE}/endian.h implicit
							make ${PACKAGE_ast_INCLUDE}/bytesex.h implicit
								make ${PACKAGE_ast_INCLUDE}/ast_common.h implicit
									prev ${PACKAGE_ast_INCLUDE}/ast_map.h implicit
									prev ${PACKAGE_ast_INCLUDE}/endian.h
								done ${PACKAGE_ast_INCLUDE}/ast_common.h
							done ${PACKAGE_ast_INCLUDE}/bytesex.h
						done ${PACKAGE_ast_INCLUDE}/endian.h
					done sum-sha2.c dontcare
					prev sum-sha1.c implicit dontcare
					prev sum-md5.c implicit dontcare
					make sum-lmd.c implicit
						prev sha2.h implicit dontcare virtual
						prev sha1.h implicit dontcare virtual
						prev md5.h implicit dontcare virtual
						prev md4.h implicit dontcare virtual
					done sum-lmd.c dontcare
					make sum-prng.c implicit
						make ${PACKAGE_ast_INCLUDE}/fnv.h implicit
							prev ${PACKAGE_ast_INCLUDE}/ast_common.h
						done ${PACKAGE_ast_INCLUDE}/fnv.h
					done sum-prng.c
					prev sum-bsd.c implicit
					prev sum-ast4.c implicit
					make FEATURE/sum implicit
						prev features/sum
						bind -last
						exec - iffe ${IFFEFLAGS} -v -c "${CC} ${mam_cc_FLAGS} ${CCFLAGS} ${LDFLAGS}" ref ${mam_cc_L+-L${INSTALLROOT}/lib} -I${PACKAGE_ast_INCLUDE} -I${INSTALLROOT}/include ${mam_libast} : run features/sum
					done FEATURE/sum generated
					prev ${PACKAGE_ast_INCLUDE}/hashpart.h implicit
					make ${PACKAGE_ast_INCLUDE}/swap.h implicit
						prev ${PACKAGE_ast_INCLUDE}/ast_common.h
					done ${PACKAGE_ast_INCLUDE}/swap.h
					prev ${PACKAGE_ast_INCLUDE}/endian.h
					make sum.h implicit
						make ${PACKAGE_ast_INCLUDE}/ast.h implicit
							prev ${PACKAGE_ast_INCLUDE}/ast_api.h implicit
							make ${PACKAGE_ast_INCLUDE}/vmalloc.h implicit
								prev ${PACKAGE_ast_INCLUDE}/ast_common.h
								make ${PACKAGE_ast_INCLUDE}/ast_std.h implicit
									make ${PACKAGE_ast_INCLUDE}/regex.h implicit
										prev ${PACKAGE_ast_INCLUDE}/ast_api.h
										make ${PACKAGE_ast_INCLUDE}/ast_wchar.h implicit
											make ${PACKAGE_ast_INCLUDE}/wctype.h implicit
												make ${PACKAGE_ast_INCLUDE}/ast_wctype.h implicit
													prev ${PACKAGE_ast_INCLUDE}/endian.h
													make ${PACKAGE_ast_INCLUDE}/wchar.h implicit
														prev ${PACKAGE_ast_INCLUDE}/ast_wchar.h
													done ${PACKAGE_ast_INCLUDE}/wchar.h
												done ${PACKAGE_ast_INCLUDE}/ast_wctype.h
											done ${PACKAGE_ast_INCLUDE}/wctype.h
											make ${PACKAGE_ast_INCLUDE}/stdio.h implicit
												make ${PACKAGE_ast_INCLUDE}/ast_stdio.h implicit
													prev ${PACKAGE_ast_INCLUDE}/sfio_s.h implicit
													prev ${PACKAGE_ast_INCLUDE}/ast_std.h
												done ${PACKAGE_ast_INCLUDE}/ast_stdio.h
											done ${PACKAGE_ast_INCLUDE}/stdio.h
											prev ${PACKAGE_ast_INCLUDE}/ast_common.h
										done ${PACKAGE_ast_INCLUDE}/ast_wchar.h
										prev ${PACKAGE_ast_INCLUDE}/ast_common.h
									done ${PACKAGE_ast_INCLUDE}/regex.h
									make ${PACKAGE_ast_INCLUDE}/getopt.h implicit
										prev ${PACKAGE_ast_INCLUDE}/ast_getopt.h implicit
									done ${PACKAGE_ast_INCLUDE}/getopt.h
									prev ${PACKAGE_ast_INCLUDE}/ast_map.h
									prev ${PACKAGE_ast_INCLUDE}/ast_botch.h implicit
									prev ${PACKAGE_ast_INCLUDE}/ast_limits.h implicit
									make ${PACKAGE_ast_INCLUDE}/ast_fcntl.h implicit
										prev ${PACKAGE_ast_INCLUDE}/ast_fs.h implicit
									done ${PACKAGE_ast_INCLUDE}/ast_fcntl.h
									prev ${PACKAGE_ast_INCLUDE}/ast_getopt.h
									make ${PACKAGE_ast_INCLUDE}/ast_sys.h implicit
										prev ${PACKAGE_ast_INCLUDE}/getopt.h
										prev ${PACKAGE_ast_INCLUDE}/endian.h
										prev ${PACKAGE_ast_INCLUDE}/endian.h
									done ${PACKAGE_ast_INCLUDE}/ast_sys.h
									prev ${PACKAGE_ast_INCLUDE}/ast_lib.h implicit
									prev ${PACKAGE_ast_INCLUDE}/ast_common.h
								done ${PACKAGE_ast_INCLUDE}/ast_std.h
							done ${PACKAGE_ast_INCLUDE}/vmalloc.h
							make ${PACKAGE_ast_INCLUDE}/sfio.h implicit
								prev ${PACKAGE_ast_INCLUDE}/sfio_s.h
								prev ${PACKAGE_ast_INCLUDE}/ast_common.h
								prev ${PACKAGE_ast_INCLUDE}/ast_std.h
							done ${PACKAGE_ast_INCLUDE}/sfio.h
							prev ${PACKAGE_ast_INCLUDE}/ast_std.h
						done ${PACKAGE_ast_INCLUDE}/ast.h
					done sum.h
					make sum-att.c implicit
						prev ${PACKAGE_ast_INCLUDE}/ast.h
					done sum-att.c
					make sum-crc.c implicit
						prev ${PACKAGE_ast_INCLUDE}/ast.h
					done sum-crc.c
				done sumlib.c
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -c sumlib.c
			done sumlib.o generated
			exec - ${AR} rc libsum.a sumlib.o
			exec - (ranlib libsum.a) >/dev/null 2>&1 || true
		done libsum.a generated
	done sum virtual
	prev libsum.a
	make ${INSTALLROOT}/lib
		exec - if test ! -d ${INSTALLROOT}/lib
		exec - then mkdir -p ${INSTALLROOT}/lib
		exec - fi
	done ${INSTALLROOT}/lib generated
	make ${INSTALLROOT}/lib/libsum.a archive
		prev ${INSTALLROOT}/lib
		prev libsum.a
		exec - ${STDCMP} 2>/dev/null -s libsum.a ${INSTALLROOT}/lib/libsum.a || { ${STDMV} ${INSTALLROOT}/lib/libsum.a ${INSTALLROOT}/lib/libsum.a.old 2>/dev/null || true; ${STDCP} libsum.a ${INSTALLROOT}/lib/libsum.a ;}
		exec - (ranlib ${INSTALLROOT}/lib/libsum.a) >/dev/null 2>&1 || true
	done ${INSTALLROOT}/lib/libsum.a generated
	make ${INSTALLROOT}/lib/lib
		exec - if test ! -d ${INSTALLROOT}/lib/lib
		exec - then mkdir -p ${INSTALLROOT}/lib/lib
		exec - fi
	done ${INSTALLROOT}/lib/lib generated
	make ${INSTALLROOT}/lib/lib/sum
		prev ${INSTALLROOT}/lib/lib
		prev sum.req
		exec - ${STDCMP} 2>/dev/null -s sum.req ${INSTALLROOT}/lib/lib/sum || { ${STDMV} ${INSTALLROOT}/lib/lib/sum ${INSTALLROOT}/lib/lib/sum.old 2>/dev/null || true; ${STDCP} sum.req ${INSTALLROOT}/lib/lib/sum ;}
	done ${INSTALLROOT}/lib/lib/sum generated
	make ${PACKAGE_ast_INCLUDE}
		exec - if test ! -d ${PACKAGE_ast_INCLUDE}
		exec - then mkdir -p ${PACKAGE_ast_INCLUDE}
		exec - fi
	done ${PACKAGE_ast_INCLUDE} generated
	make ${PACKAGE_ast_INCLUDE}/sum.h
		prev ${PACKAGE_ast_INCLUDE}
		prev sum.h
		exec - if ! cmp -s sum.h ${PACKAGE_ast_INCLUDE}/sum.h
		exec - then ${STDCP} sum.h ${PACKAGE_ast_INCLUDE}/sum.h
		exec - fi
	done ${PACKAGE_ast_INCLUDE}/sum.h generated
done install virtual
make test
done test dontcare virtual
