note *
note * This build file is in the Make Abstract Machine (MAM) language. It was
note * first generated by nmake, but in the ksh 93u+m distribution we maintain
note * it manually because nmake had too many problems to keep using. The
note * Mamfiles are processed by mamake (src/cmd/INIT/mamake.c); we added
note * indentation to improve readability. The language is documented in
note * src/cmd/INIT/README-mamake.md.
note *
setv MAMAKE_STRICT
setv INSTALLROOT ../../..
setv PACKAGE_ast_INCLUDE ${INSTALLROOT}/include/ast
setv PACKAGE_cmd ${INSTALLROOT}
setv PACKAGEROOT ../../../../..
setv CC cc
setv mam_cc_FLAGS
setv CCFLAGS ${-debug-symbols?1?${mam_cc_DEBUG} -D_BLD_DEBUG?${mam_cc_OPTIMIZE}?}
setv CCLDFLAGS ${-strip-symbols?1?${mam_cc_LD_STRIP}??}
setv IFFEFLAGS
setv LDFLAGS
make .INIT
	prev ${PACKAGE_ast_INCLUDE}/cmdlist.h
	exec - sed -e '/^CMDLIST(.*)$/!d' -e 's/CMDLIST(\(.*\))/\1/' -e '/^getconf$/d' -e '/^ln$/d' -e '/^mv$/d' -e '/^md5sum$/d' -e '/^sum$/d' ${PACKAGE_ast_INCLUDE}/cmdlist.h
	bind -lcmd
done .INIT dontcare virtual
make install
	make pty
		make pty.o
			make pty.c
				make FEATURE/pty implicit
					prev features/pty
					exec - iffe ${IFFEFLAGS} -v -c "${CC} ${mam_cc_FLAGS} ${CCFLAGS} ${LDFLAGS}" ref ${mam_cc_L+-L${INSTALLROOT}/lib} -I${PACKAGE_ast_INCLUDE} -I${INSTALLROOT}/include ${mam_libast} ${mam_libcmd} : run features/pty
				done FEATURE/pty generated
				prev ${PACKAGE_ast_INCLUDE}/ast_time.h implicit
				make ${PACKAGE_ast_INCLUDE}/vmalloc.h implicit
					make ${PACKAGE_ast_INCLUDE}/ast_common.h implicit
						prev ${PACKAGE_ast_INCLUDE}/ast_map.h implicit
						make ${PACKAGE_ast_INCLUDE}/endian.h implicit
							make ${PACKAGE_ast_INCLUDE}/bytesex.h implicit
								prev ${PACKAGE_ast_INCLUDE}/ast_common.h
							done ${PACKAGE_ast_INCLUDE}/bytesex.h
						done ${PACKAGE_ast_INCLUDE}/endian.h
					done ${PACKAGE_ast_INCLUDE}/ast_common.h
					make ${PACKAGE_ast_INCLUDE}/ast_std.h implicit
						make ${PACKAGE_ast_INCLUDE}/regex.h implicit
							prev ${PACKAGE_ast_INCLUDE}/ast_api.h implicit
							make ${PACKAGE_ast_INCLUDE}/ast_wchar.h implicit
								make ${PACKAGE_ast_INCLUDE}/wctype.h implicit
									make ${PACKAGE_ast_INCLUDE}/ast_wctype.h implicit
										prev ${PACKAGE_ast_INCLUDE}/endian.h
										make ${PACKAGE_ast_INCLUDE}/wchar.h implicit
											prev ${PACKAGE_ast_INCLUDE}/ast_wchar.h
										done ${PACKAGE_ast_INCLUDE}/wchar.h
									done ${PACKAGE_ast_INCLUDE}/ast_wctype.h
								done ${PACKAGE_ast_INCLUDE}/wctype.h
								make ${PACKAGE_ast_INCLUDE}/stdio.h implicit
									make ${PACKAGE_ast_INCLUDE}/ast_stdio.h implicit
										prev ${PACKAGE_ast_INCLUDE}/sfio_s.h implicit
										prev ${PACKAGE_ast_INCLUDE}/ast_std.h
									done ${PACKAGE_ast_INCLUDE}/ast_stdio.h
								done ${PACKAGE_ast_INCLUDE}/stdio.h
								prev ${PACKAGE_ast_INCLUDE}/ast_common.h
							done ${PACKAGE_ast_INCLUDE}/ast_wchar.h
							prev ${PACKAGE_ast_INCLUDE}/ast_common.h
						done ${PACKAGE_ast_INCLUDE}/regex.h
						make ${PACKAGE_ast_INCLUDE}/getopt.h implicit
							prev ${PACKAGE_ast_INCLUDE}/ast_getopt.h implicit
						done ${PACKAGE_ast_INCLUDE}/getopt.h
						prev ${PACKAGE_ast_INCLUDE}/ast_map.h
						prev ${PACKAGE_ast_INCLUDE}/ast_botch.h implicit
						prev ${PACKAGE_ast_INCLUDE}/ast_limits.h implicit
						make ${PACKAGE_ast_INCLUDE}/ast_fcntl.h implicit
							prev ${PACKAGE_ast_INCLUDE}/ast_fs.h implicit
						done ${PACKAGE_ast_INCLUDE}/ast_fcntl.h
						prev ${PACKAGE_ast_INCLUDE}/ast_getopt.h
						make ${PACKAGE_ast_INCLUDE}/ast_sys.h implicit
							prev ${PACKAGE_ast_INCLUDE}/getopt.h
							prev ${PACKAGE_ast_INCLUDE}/endian.h
							prev ${PACKAGE_ast_INCLUDE}/endian.h
						done ${PACKAGE_ast_INCLUDE}/ast_sys.h
						prev ${PACKAGE_ast_INCLUDE}/ast_lib.h implicit
						prev ${PACKAGE_ast_INCLUDE}/ast_common.h
					done ${PACKAGE_ast_INCLUDE}/ast_std.h
				done ${PACKAGE_ast_INCLUDE}/vmalloc.h
				prev ${PACKAGE_ast_INCLUDE}/regex.h
				make ${PACKAGE_ast_INCLUDE}/proc.h implicit
					make ${PACKAGE_ast_INCLUDE}/ast.h implicit
						prev ${PACKAGE_ast_INCLUDE}/ast_api.h
						prev ${PACKAGE_ast_INCLUDE}/vmalloc.h
						make ${PACKAGE_ast_INCLUDE}/sfio.h implicit
							prev ${PACKAGE_ast_INCLUDE}/sfio_s.h
							prev ${PACKAGE_ast_INCLUDE}/ast_common.h
							prev ${PACKAGE_ast_INCLUDE}/ast_std.h
						done ${PACKAGE_ast_INCLUDE}/sfio.h
						prev ${PACKAGE_ast_INCLUDE}/ast_std.h
					done ${PACKAGE_ast_INCLUDE}/ast.h
				done ${PACKAGE_ast_INCLUDE}/proc.h
				make ${PACKAGE_ast_INCLUDE}/error.h implicit
					make ${PACKAGE_ast_INCLUDE}/option.h implicit
						prev ${PACKAGE_ast_INCLUDE}/ast.h
					done ${PACKAGE_ast_INCLUDE}/option.h
					prev ${PACKAGE_ast_INCLUDE}/ast.h
				done ${PACKAGE_ast_INCLUDE}/error.h
				make ${PACKAGE_ast_INCLUDE}/cmd.h implicit
					prev ${PACKAGE_ast_INCLUDE}/dlldefs.h implicit dontcare
					make ${PACKAGE_ast_INCLUDE}/cmdext.h implicit
						prev ${PACKAGE_ast_INCLUDE}/shcmd.h implicit
					done ${PACKAGE_ast_INCLUDE}/cmdext.h
					prev ${PACKAGE_ast_INCLUDE}/shcmd.h
					make ${PACKAGE_ast_INCLUDE}/stk.h implicit
						prev ${PACKAGE_ast_INCLUDE}/sfio.h
					done ${PACKAGE_ast_INCLUDE}/stk.h
					prev ${PACKAGE_ast_INCLUDE}/error.h
					prev ${PACKAGE_ast_INCLUDE}/ast.h
				done ${PACKAGE_ast_INCLUDE}/cmd.h
			done pty.c
			exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -DERROR_CATALOG=\""builtin"\" -DCMD_STANDALONE=b_pty -c pty.c
		done pty.o generated
		bind -lutil dontcare
		exec - ${CC} ${CCLDFLAGS} ${mam_cc_FLAGS} ${CCFLAGS} ${LDFLAGS} ${mam_cc_L+-L.} ${mam_cc_L+-L${INSTALLROOT}/lib} -o pty pty.o ${mam_libutil} ${mam_libast} -lm ${mam_libcmd}
	done pty generated
	make ${INSTALLROOT}/bin
		exec - mkdir -p ${INSTALLROOT}/bin
	done ${INSTALLROOT}/bin generated
	make ${INSTALLROOT}/bin/pty
		prev pty
		exec - ${STDCMP} 2>/dev/null -s pty ${INSTALLROOT}/bin/pty || { ${STDMV} ${INSTALLROOT}/bin/pty ${INSTALLROOT}/bin/pty.old 2>/dev/null || true; ${STDCP} pty ${INSTALLROOT}/bin/pty ;}
	done ${INSTALLROOT}/bin/pty generated
done install virtual
make test
done test dontcare virtual
